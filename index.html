<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pittsburgh Steelers — Latest</title>

  <style>
    body { font-family: Arial, sans-serif; background:#000; color:#fff; margin:0; padding:18px; text-align:center; }
    h1 { margin:6px 0 12px; font-size:22px; }
    .card { background:#111; padding:14px; border-radius:10px; display:inline-block; min-width:340px; }
    .team { display:inline-block; width:140px; vertical-align:middle; }
    .score { font-size:32px; display:inline-block; width:70px; vertical-align:middle; font-weight:bold; }
    .status { margin-top:8px; font-size:14px; color:#ccc; }
    #schedule { margin-top:14px; text-align:left; max-height:260px; overflow:auto; }
    .gameRow { padding:10px 12px; border-bottom:1px solid rgba(255,255,255,0.08); }
    small { color:#bbb; }
  </style>
</head>

<body>
  <h1>Pittsburgh Steelers — Latest Game & Schedule</h1>

  <div id="main" class="card">
    <div id="loading">Loading…</div>

    <div id="content" style="display:none;">
      <div id="latestGameContainer"></div>
      <div class="status"><small id="fetchedAt"></small></div>

      <h3 style="margin-top:16px; margin-bottom:6px; font-size:18px;">Upcoming Games</h3>
      <div id="schedule"></div>
    </div>
  </div>

  <script>
    const API = "/api/steelers";

    function safeDate(d) {
      const dt = new Date(d);
      return isNaN(dt.getTime()) ? null : dt;
    }

    async function render() {
      const loading = document.getElementById("loading");
      const content = document.getElementById("content");
      const latestContainer = document.getElementById("latestGameContainer");
      const scheduleDiv = document.getElementById("schedule");
      const fetchedEl = document.getElementById("fetchedAt");

      loading.style.display = "block";
      content.style.display = "none";

      try {
        const res = await fetch(API);
        const json = await res.json();

        loading.style.display = "none";
        content.style.display = "block";

        fetchedEl.textContent = "Updated: " + json.updated;

        // ========== LATEST GAME ==========
        const latest = json.latestGame;

        if (latest) {
          const dt = safeDate(latest.gameDate);

          latestContainer.innerHTML = `
            <div>
              <div class="team"><strong>${latest.away.name}</strong></div>
              <div class="score">${latest.away.score ?? "-"}</div>

              <div class="team" style="text-align:right;"><strong>${latest.home.name}</strong></div>

              <div style="clear:both;"></div>

              <div class="status">
                Week ${latest.week} — ${latest.status}
                <br>
                ${dt ? dt.toLocaleString() : "Invalid Date"}
              </div>
            </div>
          `;
        } else {
          latestContainer.innerHTML = "<div>No recent game found.</div>";
        }

        // ========== UPCOMING GAMES ==========
        scheduleDiv.innerHTML = "";
        let upcoming = json.upcomingGames || [];

        upcoming.forEach(g => {
          const dt = safeDate(g.gameDate);
          const row = document.createElement("div");

          row.className = "gameRow";
          row.innerHTML = `
            <div><strong>${g.away.name}</strong> @ <strong>${g.home.name}</strong></div>
            <div><small>
              Week ${g.week} — ${g.status}<br>
              ${dt ? dt.toLocaleString() : "Invalid Date"}
            </small></div>
          `;

          scheduleDiv.appendChild(row);
        });

        if (upcoming.length === 0) {
          scheduleDiv.innerHTML = '<div class="gameRow">No upcoming games found.</div>';
        }

      } catch (err) {
        loading.style.display = "none";
        content.style.display = "block";

        latestContainer.innerHTML = '<div style="color:salmon">Failed to load data.</div>';
        scheduleDiv.innerHTML = `<div style="color:salmon">${err.message || String(err)}</div>`;
      }
    }

    render();
    setInterval(render, 45 * 1000);
  </script>
</body>
</html>
