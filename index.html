<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pittsburgh Penguins — Latest</title>
  <style>
    body { font-family: Arial, sans-serif; background:#000; color:#fff; margin:0; padding:18px; text-align:center; }
    h1 { margin:6px 0 12px; font-size:20px; }
    .card { background:#111; padding:14px; border-radius:10px; display:inline-block; min-width:320px; }
    .team { display:inline-block; width:130px; vertical-align:middle; }
    .score { font-size:28px; display:inline-block; width:80px; vertical-align:middle; }
    .status { margin-top:8px; font-size:14px; color:#ccc; }
    #schedule { margin-top:14px; text-align:left; max-height:260px; overflow:auto; }
    .gameRow { padding:8px 10px; border-bottom:1px solid rgba(255,255,255,0.04); }
    small { color:#bbb; }
  </style>
</head>
<body>
  <h1>Pittsburgh Penguins — Latest Game & Schedule</h1>
  <div id="main" class="card">
    <div id="loading">Loading…</div>
    <div id="content" style="display:none;">
      <div id="latestGameContainer"></div>
      <div class="status"><small id="fetchedAt"></small></div>
      <h3 style="margin-top:12px; margin-bottom:6px; font-size:16px;">Upcoming Games</h3>
      <div id="schedule"></div>
    </div>
  </div>

  <script>
    const API = '/api/penguins'; // relative path on vercel deployment; change to full URL if needed

    async function render() {
      const loading = document.getElementById('loading');
      const content = document.getElementById('content');
      const latestContainer = document.getElementById('latestGameContainer');
      const scheduleDiv = document.getElementById('schedule');
      const fetchedEl = document.getElementById('fetchedAt');

      loading.style.display = 'block';
      content.style.display = 'none';

      try {
        const res = await fetch(API);
        const json = await res.json();

        loading.style.display = 'none';
        content.style.display = 'block';

        fetchedEl.textContent = 'Updated: ' + (json.fetchedAt || new Date().toISOString());

        // latest game
        const latest = json.latestGame;
        if (latest) {
          latestContainer.innerHTML = `
            <div>
              <div class="team"><strong>${latest.away.name}</strong></div>
              <div class="score">${latest.away.score ?? '-'}</div>
              <div class="team" style="text-align:right;"><strong>${latest.home.name}</strong></div>
              <div style="clear:both;"></div>
              <div class="status">Status: ${latest.status} — ${new Date(latest.gameDate).toLocaleString()}</div>
            </div>
          `;
        } else {
          latestContainer.innerHTML = '<div>No recent game found.</div>';
        }

        // schedule
        scheduleDiv.innerHTML = '';
        const upcoming = json.upcomingGames || [];
        if (upcoming.length === 0) {
          scheduleDiv.innerHTML = '<div class="gameRow">No upcoming games in the returned schedule.</div>';
        } else {
          upcoming.forEach(g => {
            const el = document.createElement('div');
            el.className = 'gameRow';
            el.innerHTML = `
              <div><strong>${g.away.name}</strong> @ <strong>${g.home.name}</strong></div>
              <div><small>${new Date(g.gameDate).toLocaleString()} — Status: ${g.status}</small></div>
            `;
            scheduleDiv.appendChild(el);
          });
        }

      } catch (err) {
        loading.style.display = 'none';
        content.style.display = 'block';
        latestContainer.innerHTML = '<div style="color:salmon">Failed to load data.</div>';
        scheduleDiv.innerHTML = '<div style="color:salmon">' + (err && err.message ? err.message : String(err)) + '</div>';
      }
    }

    render();

    // auto-refresh every 45 seconds
    setInterval(render, 45 * 1000);
  </script>
</body>
</html>
